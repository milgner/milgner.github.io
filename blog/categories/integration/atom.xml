<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: integration, | Extroverted Introspection]]></title>
  <link href="http://milgner.github.io/blog/categories/integration/atom.xml" rel="self"/>
  <link href="http://milgner.github.io/"/>
  <updated>2014-06-07T10:07:26+02:00</updated>
  <id>http://milgner.github.io/</id>
  <author>
    <name><![CDATA[Marcus Ilgner]]></name>
    <email><![CDATA[blog@marcusilgner.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Gitlab CI: Clashing Sidekiqs]]></title>
    <link href="http://milgner.github.io/blog/2014/06/04/gitlab-ci-clashing-sidekiqs/"/>
    <updated>2014-06-04T23:42:00+02:00</updated>
    <id>http://milgner.github.io/blog/2014/06/04/gitlab-ci-clashing-sidekiqs</id>
    <content type="html"><![CDATA[<p>For a few months now I have been wondering about occasional hickups in my
<a href="https://www.gitlab.com/gitlab-ce/">Gitlab</a> setup. I run both Gitlab and
<a href="https://www.gitlab.com/gitlab-ci/">Gitlab CI</a> on my server, along with a number
of other Rails-based applications.</p>

<p>Since I could mostly relate these to the creation of new repository, which is
something I don&rsquo;t do that often, I didn&rsquo;t care that much about it.</p>

<p>But then today it happened again and, having some time on my hands, I decided to
finally investigate. As it turns out, it was a problem with both Gitlab and its
CI using the (wonderful) <a href="http://sidekiq.org/">Sidekiq</a> gem for asynchronous job
execution. And both instances tried to use the same <a href="http://redis.io">Redis</a>
instance, getting hopelessly tangled in the process.</p>

<p>Luckily, this kind of situation can be easily solved with a custom initializer.
Just create a new file, <code>config/initializers/sidekiq.rb</code> in each project, with
the following content:</p>

<p>``` ruby config/initializers/sidekiq.rb
require &lsquo;sidekiq&rsquo;</p>

<p>redisConfig = {
  namespace: &lsquo;Gitlab&rsquo;, # adapt name for each project
  url: &lsquo;redis://127.0.0.1:6379/1&rsquo; # replace &lsquo;1&rsquo; with a unique number
}</p>

<p>Sidekiq.configure_client do |config|
  config.redis = redisConfig
end</p>

<p>Sidekiq.configure_server do |config|
  config.redis = redisConfig
end
```</p>

<p>Technically speaking, the namespace is not required but I think it&rsquo;s a good idea
nonetheless.</p>
]]></content>
  </entry>
  
</feed>
